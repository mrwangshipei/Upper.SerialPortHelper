\## SerialPortHelper ä¸²å£é€šä¿¡å·¥å…·ç±»



`SerialPortHelper` æ˜¯ä¸€ä¸ªä¸“ä¸ºè‡ªå®šä¹‰ä¸²å£åè®®è®¾è®¡çš„è¾…åŠ©ç±»ï¼Œé€‚ç”¨äºéœ€è¦è¯†åˆ«å®Œæ•´å¸§ï¼ˆå¦‚å¸§å¤´/å¸§å°¾/æ ¡éªŒï¼‰çš„é€šä¿¡åœºæ™¯ï¼Œå…¸å‹ç”¨äºå·¥ä¸šè®¾å¤‡ã€åµŒå…¥å¼ç³»ç»Ÿã€ä»ªå™¨é€šè®¯ç­‰ã€‚



---



\### âœ… æ ¸å¿ƒåŠŸèƒ½



\* \*\*å®Œæ•´å¸§åˆ¤æ–­æœºåˆ¶\*\*ï¼šé€šè¿‡ç”¨æˆ·ä¼ å…¥çš„åˆ¤æ–­é€»è¾‘è¯†åˆ«æ˜¯å¦å·²æ”¶åˆ°å®Œæ•´æ•°æ®å¸§ã€‚

\* \*\*è‡ªé€‚åº”å»¶è¿Ÿè§¦å‘æœºåˆ¶\*\*ï¼šé¿å…æ•°æ®åŒ…æˆªæ–­æˆ–æ—©è¯»ã€‚

\* \*\*çº¿ç¨‹å®‰å…¨çš„è¯»å†™æ§åˆ¶\*\*ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯é é€šä¿¡ã€‚

\* \*\*æ”¯æŒç¼“å­˜æŸ¥çœ‹ï¼ˆPeekï¼‰ä¸æ¸…é™¤ï¼ˆReadAndClearï¼‰\*\*ï¼šçµæ´»ç®¡ç†ä¸²å£ç¼“å†²åŒºã€‚

\* \*\*æ”¯æŒå‘é€åç­‰å¾…å“åº”ï¼ˆSendAndWaitResultï¼‰\*\*ï¼šå°è£…å…¸å‹æ”¶å‘æµç¨‹ã€‚



---



\### ğŸ§± å…¸å‹ç”¨æ³•



```csharp

using System.IO.Ports;

using Upper.SerialPortHelper;



SerialPort sp = new SerialPort("COM3", 9600);

var helper = new SerialPortHelper(sp);



helper.IsFullFrame += (data) =>

{

&nbsp;   // ç¤ºä¾‹ï¼šå®Œæ•´å¸§ä»¥ 0xAA å¼€å¤´ï¼Œ0xFF ç»“å°¾ï¼Œä¸”é•¿åº¦å¤§äºç­‰äº5

&nbsp;   return data.Length >= 5 \&\& data\[0] == 0xAA \&\& data\[^1] == 0xFF;

};



if (helper.Open())

{

&nbsp;   byte\[] cmd = new byte\[] { 0xAA, 0x01, 0x02, 0x03, 0xFF };

&nbsp;   byte\[] response = helper.SendAndWaitResult(cmd, 100, onlyread: false);



&nbsp;   Console.WriteLine(BitConverter.ToString(response));

}

```



---



\### ğŸ“Œ æ–¹æ³•è¯´æ˜



| æ–¹æ³•                                                                   | æè¿°               |

| -------------------------------------------------------------------- | ---------------- |

| `SerialPortHelper(SerialPort serial, int MsgsWaitTime = 35)`         | åˆå§‹åŒ–å¸®åŠ©ç±»ï¼Œç»‘å®šå¤–éƒ¨ä¸²å£å®ä¾‹  |

| `bool Open()` / `bool Close()`                                       | æ‰“å¼€ / å…³é—­ä¸²å£è¿æ¥      |

| `void Send(byte\[] msg)`                                              | å‘é€æ•°æ®ï¼Œä¸ç­‰å¾…å“åº”       |

| `byte\[] SendAndWaitResult(byte\[] data, int waittime, bool onlyread)` | å‘é€æ•°æ®å¹¶ç­‰å¾…æ¥æ”¶å®Œæ•´å¸§     |

| `byte\[] ReadAndClear(int waitms)`                                    | è¯»å–æ•°æ®å¹¶æ¸…ç©ºç¼“å­˜åŒº       |

| `byte\[] Peek(int waitms)`                                            | åªæŸ¥çœ‹ç¼“å­˜åŒºæ•°æ®ï¼Œä¸æ¸…é™¤     |

| `byte\[] Receive(int waitms, bool onlyread = false)`                  | é€šç”¨è¯»å–å‡½æ•°ï¼Œæ”¯æŒåªè¯»æˆ–æ¸…é™¤ç¼“å­˜ |



---



\### ğŸ§  æ³¨æ„äº‹é¡¹



\* æœ¬ç±» \*\*ä»…æ”¯æŒå•ä¸ªä¸²å£å®ä¾‹ç®¡ç†\*\*ï¼Œå¦‚éœ€å¤šä¸²å£é€šä¿¡ï¼Œå¯è‡ªè¡Œå°è£…å­—å…¸ç®¡ç†ï¼š`Dictionary<string, SerialPortHelper>`ã€‚

\* `IsFullFrame` æ˜¯å…³é”®é€»è¾‘ï¼Œå¿…é¡»ç”±ç”¨æˆ·æä¾›å®Œæ•´å¸§çš„è¯†åˆ«æ–¹å¼ï¼Œå¦åˆ™å»¶è¿Ÿæœºåˆ¶ä¼šé€€åŒ–ä¸ºå®šæ—¶é‡Šæ”¾ã€‚

\* `SendAndWaitResult` æ¨èç”¨äºå…¸å‹â€œè¯·æ±‚-å“åº”â€ç»“æ„çš„åè®®å°è£…ã€‚

\* æ‰€æœ‰æ‰‹åŠ¨ `Receive` çš„æ“ä½œï¼Œåº”åœ¨ç¡®è®¤çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹è°ƒç”¨ã€‚



---



\### â™»ï¸ èµ„æºé‡Šæ”¾



ä½¿ç”¨ç»“æŸåè¯·åŠæ—¶é‡Šæ”¾èµ„æºé¿å…çº¿ç¨‹æŒ‚èµ·æˆ–å¥æŸ„æ³„æ¼ï¼š



```csharp

helper.Dispose();

```



---



å¦‚éœ€è‹±æ–‡æ–‡æ¡£ã€å•å…ƒæµ‹è¯•ç¤ºä¾‹ã€æˆ–å¤šä¸²å£å°è£…æ ·ä¾‹ï¼Œå¯è”ç³»è¡¥å……ã€‚



